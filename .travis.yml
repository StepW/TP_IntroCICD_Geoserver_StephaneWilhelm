#le langage utilisé est java
language: java

# le cache est sencé faire un "speed up" du build
cache:
  directories:
  - $HOME/.m2

# les différentes étapes d'intégration/ déploiement
jobs:
 include:
 # le build compile le projet sans faire les tests et. La documentation statique est également construite, des fichiers html reliés sont générée dans un répertoire target/doc/docguide/html
 # les commandes sont trouvées à partir du README fourni dans le projet
 - stage: build
    before_install:
      - cd src
    script:
      - mvn -DskipTests clean install
      - cd ../doc/en
      - mvn clean install
      - mvn process-resources
      - mvn compile
      - mvn compile -Puser
      - mvn compile -Pdeveloper
      - mvn compile -Pdocguide
  # L'étape de test va faire deux tests parallèles sur deux plateformes java différents : openjdk8 et openjdk11
  # Le build de l'application passe automatiquement les tests unitaires et les test d'intégration suivant la configuration intégrée 
  # Le code à tester est effectié dans le répertoire "src".
  - stage: test
    before_install:
      - cd src
    name: jdk8
    jdk: openjdk8
    script: mvn clean install

  - name: jdk11
    before_install:
    - cd src
    jdk: openjdk11
    script: mvn clean install
# Le deploiement est sencée se faire pour la documentation geoserver générée sur chaque branche à l'aide du mobule "gh-pages" dans github
# ceci se fait dans les options de github en choisisant les branches de déploiement du site.
  - stage: deploy
    script:
     - cd doc/en
    deploy:
     provider: pages
     api_key: $GITHUB_TOKEN
     local_dir: target/docguide/html
     skip_cleanup: true
     on:
     # tag est cense "simuler" le bon fonctionnement du code en interrompant le déploiement en étant pas un "tagget commit"
      tags: true
      all_branches: true
