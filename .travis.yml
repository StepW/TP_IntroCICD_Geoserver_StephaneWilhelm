language: java


cache:
  directories:
  - $HOME/.m2

# git_token: 5b699a6b6925048ac9156d3072f84f4de13af9f3
env:
 global:
  - secure: 5b699a6b6925048ac9156d3072f84f4de13af9f3
#  - GIT_DEPLOY_REPO=https://$GITHUB_TOKEN@github.com/StepW/TP_IntroCICD_Geoserver_StephaneWilhelm.git

#before_install:
#  - cd src

#jdk:
# - openjdk8
# - openjdk11

#before_deploy:
#  - echo "deploying"

#deploy:
#    - name: deploying
#      provider: releases
#      api_key: $GITHUB_API_KEY
#      skip_cleanup: true
#      on:
#        # tags: true
#        all_branches: true
        
#install: true
#script: 
    # src building
    #- mvn clean install
    # without test
#    - echo "building and testing"
#    - mvn -DskipTests clean install
    # doc building
#after_success:
#    - cd ../doc/en
#    - mvn clean install
#    - mvn process-resources
#    - mvn compile
#    - mvn compile -Puser
#    - mvn compile -Pdeveloper
#    - mvn compile -Pdocguide


jobs:
 include:
  - stage: build
    before_install:
      - cd src
    script:
     # - echo 'build'
     # - mvn -DskipTests clean install
      - cd ../doc/en
      - mvn clean install
      - mvn process-resources
      - mvn compile
      - mvn compile -Puser
      - mvn compile -Pdeveloper
      - mvn compile -Pdocguide
#  - stage: test
#    before_install:
#      - cd src
#    name: jdk8
#    jdk: openjdk8
#    #script: mvn clean install
#    script: echo 'test'
#  - name: jdk11
#    before_install:
#    - cd src
#    jdk: openjdk11
#    #script: mvn clean install
#    script: echo 'test'
  - stage: deploy
  #- name: deploy
    #script: echo 'do deploy'

    
    script:
     #- mvn install -DskipTests=true -Dmaven.javadoc.skip=true -B -V
     - cd doc/en
     - mvn clean install
     - mvn process-resources
     - mvn compile
    deploy:
        provider: releases 
        api_key: $GITHUB_API_KEY
        #api_key:
        # secure: 25e883285b9e15cc29481bb25f6bcad68cdfe6da
        # file: target/docguide/html
         # defined via the Travis interface
        local_dir: target/docguide/html
        skip_cleanup: true
        on:
         #tags: true
         all-branches: true
     #repo: doc/en/target/docguide/html
#jobs: 
#  include: 
#    - stage: build
#      name: building-project
#      script: "sh './scripts/build.sh'"
#    - stage: test
#      name: test on jdk8
#      jdk: openjdk8
#      script:
#      - "sh './scripts/tests.sh'"
#    - name: test on jdk11
#      jdk: oraclejdk11
#      script: 
#      - "sh './scripts/tests.sh'"
#    - stage: deploy	
#      script: "sh './scripts/deploy.sh'"
#deploy:
#      name: deploying
#      provider: releases
#      api_key: $GITHUB_API_KEY
#      skip_cleanup: true
#      on:
#        tags: true
#        all_branches: true
#      #script: "sh './scripts/deploy.sh'"

